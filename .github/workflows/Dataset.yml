name: Consolidation quotidienne des pr√©dictions

on:
  schedule:
    - cron: '0 5 * * *'  # Tous les jours √† 5h UTC (5h heure C√¥te d'Ivoire)
  workflow_dispatch:       # Permet de lancer manuellement depuis l'onglet Actions

jobs:
  consolidate:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout du d√©p√¥t
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          persist-credentials: true

      - name: Configuration de Python
        uses: actions/setup-python@v4
        with:
          python-version: 3.12

      - name: Ex√©cution du script de consolidation
        run: |
          echo "üîÑ D√©marrage de la consolidation quotidienne"
          python data.py || echo "‚ùå Erreur lors de l'ex√©cution du script"
          echo "‚úÖ Script ex√©cut√©, pr√©paration du commit..."

      - name: Commit et push des modifications
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"

          # Ajouter uniquement les fichiers modifi√©s
          git add Analysesdata.json || true

          if git diff --cached --quiet; then
            echo "‚ÑπÔ∏è Aucune modification √† committer"
          else
            git commit -m "üîÑ Mise √† jour quotidienne Analysesdata.json [$(date '+%Y-%m-%d %H:%M')]"
            git push
            echo "‚úÖ Donn√©es consolid√©es et pouss√©es avec succ√®s"
          fi