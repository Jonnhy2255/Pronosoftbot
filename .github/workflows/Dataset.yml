name: Consolidation des pr√©dictions football

on:
  schedule:
    - cron: "0 5 * * *"  # Tous les jours √† 5h UTC
  workflow_dispatch:     # Permet d'ex√©cuter manuellement

jobs:
  consolidate:
    runs-on: ubuntu-latest

    steps:
      # R√©cup√©rer le code
      - name: Checkout repository
        uses: actions/checkout@v3

      # Setup Python
      - name: Setup Python 3.12
        uses: actions/setup-python@v4
        with:
          python-version: 3.12

      # Installer les d√©pendances n√©cessaires
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests

      # Ex√©cuter le script data.py avec la cl√© API inject√©e
      - name: Run data.py
        env:
          API_FOOTBALL_KEY: ${{ secrets.API_FOOTBALL_KEY }}
        run: |
          echo "üîÑ D√©but du script data.py"
          python data.py
          echo "‚úÖ Script termin√©"

      # Afficher les logs
      - name: Show consolidation log
        run: |
          if [ -f consolidation.log ]; then
            echo "üìÑ --- D√©but du fichier consolidation.log ---"
            cat consolidation.log
            echo "üìÑ --- Fin du fichier consolidation.log ---"
          else
            echo "‚ö†Ô∏è Aucun log trouv√©"
          fi

      # Commit & Push si Analysesdata.json a √©t√© modifi√©
      - name: Commit and Push changes
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add Analysesdata.json
          if ! git diff --cached --quiet; then
            git commit -m "üîÑ Mise √† jour des donn√©es consolid√©es $(date +'%Y-%m-%d %H:%M:%S')"
            git push
            echo "‚úÖ Fichier Analysesdata.json mis √† jour et pouss√©."
          else
            echo "‚ÑπÔ∏è Aucune modification √† pousser."