name: Consolidation des pr√©dictions football

on:
  schedule:
    - cron: "0 2 * * *"  # Tous les jours √† 5h UTC
  workflow_dispatch:      # Permet l'ex√©cution manuelle

jobs:
  consolidate:
    runs-on: ubuntu-latest

    env:
      API_FOOTBALL_KEY: ${{ secrets.API_FOOTBALL_KEY }}  # Cl√© API s√©curis√©e

    steps:
      # 1Ô∏è‚É£ R√©cup√©rer le code
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2Ô∏è‚É£ Installer Python
      - name: Setup Python 3.12
        uses: actions/setup-python@v4
        with:
          python-version: 3.12

      # 3Ô∏è‚É£ Installer les d√©pendances
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests

      # 4Ô∏è‚É£ Ex√©cuter le script data.py
      - name: Run data.py
        run: |
          echo "üîÑ D√©but du script data.py"
          python data.py
          echo "‚úÖ Script termin√©"

      # 5Ô∏è‚É£ Afficher les logs
      - name: Show consolidation log
        run: |
          if [ -f consolidation.log ]; then
            echo "üìÑ --- D√©but du fichier consolidation.log ---"
            cat consolidation.log
            echo "üìÑ --- Fin du fichier consolidation.log ---"
          else
            echo "‚ö†Ô∏è Aucun log trouv√©"
          fi

      # 6Ô∏è‚É£ Commit & Push si Analysesdata.json a √©t√© modifi√©
      - name: Commit and Push changes
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add Analysesdata.json
          if ! git diff --cached --quiet; then
            git commit -m "üîÑ Mise √† jour des donn√©es consolid√©es $(date +'%Y-%m-%d %H:%M:%S')"
            git push
            echo "‚úÖ Fichier Analysesdata.json mis √† jour et pouss√©."
          else
            echo "‚ÑπÔ∏è Aucune modification √† pousser."
          fi